{
  "hash": "7f4a851e43bf7e571d5f1e136873d6ca",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Incomplete Block Design\"\n---\n\n\n\n\n\n\n\n## Background\n\nThe block design in [**Chapter 4**](rcbd.qmd) was complete, meaning that every block contained all the treatments. In practice, it may not be possible to have too many treatments in each block. Sometimes, there are also situations where it is advised to not have many treatments in each block.\n\nIn such cases, incomplete block designs are used where we have to decide what subset of treatments to be used in an individual block. This will work well if we enough blocks. However, if we only have small number of blocks, there would be the risk that certain quantities are not estimable anymore.\n\nTo avoid having a disconnected design, a balanced incomplete block design can be used\n\nThe statistical model for balanced incomplete block design is:\n\n$$y_{ij} = \\mu + \\alpha_i + \\beta_j + \\epsilon_{ij}$$ Where:\n\n$\\mu$ = overall experimental mean $\\alpha$ = treatment effects (fixed) $\\beta$ = block effects (random) $\\epsilon$ = error terms\n\n$$ \\epsilon \\sim N(0, \\sigma)$$\n\n$$ \\beta \\sim N(0, \\sigma_b)$$ There are few key points that we need to keep in mind while designing incomplete block designs:\n\n-   A drawback of this design is that block effect and treatment effects are confounded.\n\n-   To eliminate of block effects, better compare treatments within a block.\n\n-   No treatment should appear twice in any block as they contributes nothing no within block comparisons.\n\nAn [excellent description of incomplete block design](https://people.math.ethz.ch/~meier/teaching/anova/incomplete-block-designs.html) is provided in [*ANOVA and Mixed Models*](https://www.taylorfrancis.com/books/mono/10.1201/9781003146216/anova-mixed-models-lukas-meier) by Lukas Meier. \n\n::: callout-note\n## A note\n\nBecause the blocks are incomplete, the Type I and Type III sums of squares will be different. That is, the missing treatments in each block represent missing observations (but not missing ‘at random’).\n:::\n\n## Example Analysis\nWe will demonstrate an example data set designed in a balanced incomplete block design. First, load the libraries required for analysis and estimation.\n\n::: panel-tabset\n### lme4\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4); library(lmerTest); library(emmeans)\nlibrary(dplyr); library(broom.mixed); library(performance)\n```\n:::\n\n\n\n\n### nlme\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(nlme); library(broom.mixed); library(emmeans)\nlibrary(dplyr); library(performance)\n```\n:::\n\n\n\n\n:::\n\nThe data used for this example analysis was extracted from the `agridat` package. This example is comprised of soybean balanced incomplete block experiment.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- agridat::weiss.incblock\n```\n:::\n\n\n\n\n|       |                              |\n|-------|------------------------------|\n| block   | blocking unit             |\n| gen   | genotype (variety) factor                |\n| row   | row position for each plot        |\n| col   | column position for each plot    |\n| yield | grain yield in bu/ac         |\n\n: Table of variables in the data set {tbl-incom_blk}\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](incomplete-block-design_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n### Data integrity checks\n\nThe first thing is to make sure the data is what we expect. There are two steps:\n\n1.  make sure data are the expected data type\n2.  check the extent of missing data\n3.  inspect the independent variables and make sure the expected levels are present in the data\n4.  inspect the dependent variable to ensure its distribution is following expectations\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t186 obs. of  5 variables:\n $ block: Factor w/ 31 levels \"B01\",\"B02\",\"B03\",..: 1 2 3 4 5 6 7 8 9 10 ...\n $ gen  : Factor w/ 31 levels \"G01\",\"G02\",\"G03\",..: 24 15 20 18 20 5 22 1 9 14 ...\n $ yield: num  29.8 24.2 30.5 20 35.2 25 23.6 23.6 29.3 25.5 ...\n $ row  : int  42 36 30 24 18 12 6 42 36 30 ...\n $ col  : int  1 1 1 1 1 1 1 2 2 2 ...\n```\n\n\n:::\n:::\n\n\n\n\n\nThese look okay with block and gen being factor variables and yield, row, and col being numeric variables.\n\nNext, check the independent variables. Running a cross tabulations is often sufficient to ascertain this.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat$row <- as.factor(dat$row)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(dat$gen, dat$block)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     \n      B01 B02 B03 B04 B05 B06 B07 B08 B09 B10 B11 B12 B13 B14 B15 B16 B17 B18\n  G01   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0   1   1\n  G02   0   0   0   0   0   0   1   1   0   0   0   0   0   0   0   1   0   0\n  G03   0   0   1   0   0   0   0   1   1   1   0   0   1   0   0   0   0   0\n  G04   0   0   0   1   0   0   0   1   0   0   1   0   0   0   0   0   0   0\n  G05   0   0   0   0   1   1   0   1   0   0   0   0   0   1   1   0   0   0\n  G06   0   0   0   0   0   0   0   0   0   1   0   0   0   1   0   0   0   0\n  G07   0   0   1   1   0   0   1   0   0   0   0   0   0   0   0   0   0   0\n  G08   0   0   0   0   0   1   0   0   0   0   0   0   1   0   0   0   1   0\n  G09   0   0   0   0   0   0   0   0   1   0   0   0   0   0   1   0   0   0\n  G10   0   0   0   0   1   0   0   0   0   0   1   0   0   0   0   1   0   1\n  G11   0   1   1   0   0   1   0   0   0   0   1   0   0   0   0   0   0   0\n  G12   0   1   0   0   0   0   1   0   0   0   0   0   0   1   0   0   0   0\n  G13   0   1   0   0   0   0   0   0   0   0   0   0   1   0   1   1   0   0\n  G14   0   1   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   1\n  G15   0   1   0   1   1   0   0   0   1   0   0   0   0   0   0   0   1   0\n  G16   0   0   0   0   0   0   0   0   1   0   0   1   0   0   0   1   0   0\n  G17   0   0   0   0   0   0   1   0   0   1   1   1   0   0   1   0   1   0\n  G18   0   0   0   1   0   0   0   0   0   0   0   1   1   1   0   0   0   1\n  G19   0   0   0   0   0   1   0   0   0   0   0   1   0   0   0   0   0   0\n  G20   0   0   1   0   1   0   0   0   0   0   0   1   0   0   0   0   0   0\n  G21   1   0   0   1   0   0   0   0   0   0   0   0   0   0   1   0   0   0\n  G22   1   0   0   0   0   1   1   0   1   0   0   0   0   0   0   0   0   1\n  G23   1   0   0   0   0   0   0   0   0   0   1   0   1   0   0   0   0   0\n  G24   1   0   1   0   0   0   0   0   0   0   0   0   0   1   0   1   1   0\n  G25   1   0   0   0   1   0   0   0   0   1   0   0   0   0   0   0   0   0\n  G26   1   1   0   0   0   0   0   1   0   0   0   1   0   0   0   0   0   0\n  G27   0   0   0   0   1   0   1   0   0   0   0   0   1   0   0   0   0   0\n  G28   0   0   1   0   0   0   0   0   0   0   0   0   0   0   1   0   0   1\n  G29   0   0   0   1   0   1   0   0   0   1   0   0   0   0   0   1   0   0\n  G30   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   1   0\n  G31   0   0   0   0   0   0   0   0   1   0   1   0   0   1   0   0   0   0\n     \n      B19 B20 B21 B22 B23 B24 B25 B26 B27 B28 B29 B30 B31\n  G01   1   0   0   0   0   0   0   0   0   0   1   1   0\n  G02   0   1   0   0   0   0   0   0   1   1   0   0   0\n  G03   0   0   0   0   1   0   0   0   0   0   0   0   0\n  G04   0   0   1   0   0   0   1   0   0   0   0   0   1\n  G05   0   0   0   0   0   1   0   0   0   0   0   0   0\n  G06   1   1   0   1   0   0   0   0   0   0   0   0   1\n  G07   0   0   0   1   0   1   0   0   0   0   1   0   0\n  G08   0   0   1   1   0   0   0   0   0   1   0   0   0\n  G09   0   0   0   1   0   0   1   0   1   0   0   1   0\n  G10   0   0   0   1   1   0   0   0   0   0   0   0   0\n  G11   1   0   0   0   0   0   0   0   1   0   0   0   0\n  G12   0   0   1   0   1   0   0   0   0   0   0   1   0\n  G13   0   0   0   0   0   0   0   0   0   0   1   0   1\n  G14   0   0   0   0   0   1   1   0   0   1   0   0   0\n  G15   0   1   0   0   0   0   0   0   0   0   0   0   0\n  G16   1   0   1   0   0   1   0   0   0   0   0   0   0\n  G17   0   0   0   0   0   0   0   0   0   0   0   0   0\n  G18   0   0   0   0   0   0   0   0   1   0   0   0   0\n  G19   0   1   0   0   1   0   1   0   0   0   1   0   0\n  G20   0   0   0   0   0   0   0   0   0   1   0   1   1\n  G21   1   0   0   0   1   0   0   0   0   1   0   0   0\n  G22   0   0   0   0   0   0   0   0   0   0   0   0   1\n  G23   0   1   0   0   0   1   0   0   0   0   0   1   0\n  G24   0   0   0   0   0   0   1   0   0   0   0   0   0\n  G25   0   0   1   0   0   0   0   0   1   0   1   0   0\n  G26   0   0   0   1   0   0   0   1   0   0   0   0   0\n  G27   1   0   0   0   0   0   1   1   0   0   0   0   0\n  G28   0   1   1   0   0   0   0   1   0   0   0   0   0\n  G29   0   0   0   0   0   0   0   1   0   0   0   1   0\n  G30   0   0   0   0   1   1   0   1   1   0   0   0   1\n  G31   0   0   0   0   0   0   0   1   0   1   1   0   0\n```\n\n\n:::\n:::\n\n\n\n\n\nThere are 31 varieties and it is perfectly balanced, with exactly one observation per treatment per block.\n\nHere is a quick check I run to count the number of missing data in each column.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\napply(dat, 2, function(x) sum(is.na(x)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nblock   gen yield   row   col \n    0     0     0     0     0 \n```\n\n\n:::\n:::\n\n\n\n\n\nWe observed no missing data!\n\nLast, check the dependent variable. A histogram is often quite sufficient to accomplish this. This is designed to be a quick check, so no need to spend time making the plot look good.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(dat$yield, main = \"\", xlab = \"yield\")\n```\n:::\n\n::: {.cell .column-margin}\n::: {.cell-output-display}\n![Histogram of the dependent variable.](incomplete-block-design_files/figure-html/fig-ibd_hist-1.png){#fig-ibd_hist width=672}\n:::\n:::\n\n\n\n\nThis data set is ready for analysis!\n\n### Model Building\n\n::: panel-tabset\n### lme4\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_icbd <- lmer(yield ~ gen + (1|block),\n                   data = dat, \n                   na.action = na.exclude)\ntidy(model_icbd)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 33 × 8\n   effect group term        estimate std.error statistic    df  p.value\n   <chr>  <chr> <chr>          <dbl>     <dbl>     <dbl> <dbl>    <dbl>\n 1 fixed  <NA>  (Intercept)  24.6        0.922   26.7     153. 2.30e-59\n 2 fixed  <NA>  genG02        2.40       1.17     2.06    129. 4.17e- 2\n 3 fixed  <NA>  genG03        8.04       1.17     6.88    129. 2.31e-10\n 4 fixed  <NA>  genG04        2.37       1.17     2.03    129. 4.42e- 2\n 5 fixed  <NA>  genG05        1.60       1.17     1.37    129. 1.73e- 1\n 6 fixed  <NA>  genG06        7.39       1.17     6.32    129. 3.82e- 9\n 7 fixed  <NA>  genG07       -0.419      1.17    -0.359   129. 7.20e- 1\n 8 fixed  <NA>  genG08        3.04       1.17     2.60    129. 1.04e- 2\n 9 fixed  <NA>  genG09        4.84       1.17     4.14    129. 6.22e- 5\n10 fixed  <NA>  genG10       -0.0429     1.17    -0.0367  129. 9.71e- 1\n# ℹ 23 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#model_icbd1 <- lmer(yield ~ gen + (1|block) +  (1|row:block),\n#                   data = dat, \n#                   na.action = na.exclude)\n#tidy(model_icbd1)\n```\n:::\n\n\n\n\n### nlme\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_icbd <- lme(yield ~ gen,\n                  random = ~ 1|block,\n                  data = dat, \n                  na.action = na.exclude)\ntidy(model_icbd)\n```\n:::\n\n\n\n\n:::\n\n\n### Check Model Assumptions\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_model(model_icbd)\n```\n\n::: {.cell-output-display}\n![](incomplete-block-design_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n\n### Inference\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(model_icbd)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nType III Analysis of Variance Table with Satterthwaite's method\n    Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \ngen 1901.1  63.369    30 129.06  17.675 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nemmeans(model_icbd, ~ gen)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n gen emmean    SE  df lower.CL upper.CL\n G01   24.6 0.923 153     22.7     26.4\n G02   27.0 0.923 153     25.2     28.8\n G03   32.6 0.923 153     30.8     34.4\n G04   26.9 0.923 153     25.1     28.8\n G05   26.2 0.923 153     24.4     28.0\n G06   32.0 0.923 153     30.1     33.8\n G07   24.2 0.923 153     22.3     26.0\n G08   27.6 0.923 153     25.8     29.4\n G09   29.4 0.923 153     27.6     31.2\n G10   24.5 0.923 153     22.7     26.4\n G11   27.1 0.923 153     25.2     28.9\n G12   29.3 0.923 153     27.4     31.1\n G13   29.9 0.923 153     28.1     31.8\n G14   24.2 0.923 153     22.4     26.1\n G15   26.1 0.923 153     24.3     27.9\n G16   25.9 0.923 153     24.1     27.8\n G17   19.7 0.923 153     17.9     21.5\n G18   25.7 0.923 153     23.9     27.5\n G19   29.0 0.923 153     27.2     30.9\n G20   33.2 0.923 153     31.3     35.0\n G21   31.1 0.923 153     29.3     32.9\n G22   25.2 0.923 153     23.3     27.0\n G23   29.8 0.923 153     28.0     31.6\n G24   33.6 0.923 153     31.8     35.5\n G25   27.0 0.923 153     25.2     28.8\n G26   27.1 0.923 153     25.3     29.0\n G27   23.8 0.923 153     22.0     25.6\n G28   26.5 0.923 153     24.6     28.3\n G29   24.8 0.923 153     22.9     26.6\n G30   36.2 0.923 153     34.4     38.0\n G31   27.1 0.923 153     25.3     28.9\n\nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \n```\n\n\n:::\n:::\n",
    "supporting": [
      "incomplete-block-design_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}